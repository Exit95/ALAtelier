---
import { Image } from 'astro:assets';
import Button from './ui/Button.astro';
import Badge from './ui/Badge.astro';

interface Props {
  title: string;
  description: string;
  date: Date;
  duration: number;
  location: string;
  price: number;
  maxParticipants: number;
  currentParticipants: number;
  status: 'upcoming' | 'booking' | 'full' | 'completed' | 'cancelled';
  image?: ImageMetadata | string;
  bookingUrl?: string;
  class?: string;
}

const {
  title,
  description,
  date,
  duration,
  location,
  price,
  maxParticipants,
  currentParticipants,
  status,
  image,
  bookingUrl,
  class: className = ''
} = Astro.props;

const availableSpots = maxParticipants - currentParticipants;
const formattedDate = new Intl.DateTimeFormat('de-DE', {
  weekday: 'long',
  year: 'numeric',
  month: 'long',
  day: 'numeric'
}).format(date);

const formattedTime = new Intl.DateTimeFormat('de-DE', {
  hour: '2-digit',
  minute: '2-digit'
}).format(date);

const statusLabels = {
  upcoming: 'Demnächst',
  booking: 'Buchbar',
  full: 'Ausgebucht',
  completed: 'Abgeschlossen',
  cancelled: 'Abgesagt'
};

const statusVariants = {
  upcoming: 'info' as const,
  booking: 'available' as const,
  full: 'sold' as const,
  completed: 'info' as const,
  cancelled: 'sold' as const
};
---

<article class:list={['workshop-card', className]}>
  {image && (
    <div class="workshop-image">
      {typeof image === 'string' ? (
        <img src={image} alt={title} loading="lazy" />
      ) : (
        <Image src={image} alt={title} loading="lazy" widths={[320, 640]} sizes="(max-width: 640px) 100vw, 50vw" />
      )}
      <div class="workshop-badge">
        <Badge label={statusLabels[status]} variant={statusVariants[status]} />
      </div>
    </div>
  )}
  
  <div class="workshop-content">
    <h3 class="workshop-title">{title}</h3>
    <p class="workshop-description">{description}</p>
    
    <div class="workshop-details">
      <div class="detail-item">
        <svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
          <line x1="16" y1="2" x2="16" y2="6"></line>
          <line x1="8" y1="2" x2="8" y2="6"></line>
          <line x1="3" y1="10" x2="21" y2="10"></line>
        </svg>
        <span>{formattedDate}, {formattedTime} Uhr</span>
      </div>
      
      <div class="detail-item">
        <svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <circle cx="12" cy="12" r="10"></circle>
          <polyline points="12 6 12 12 16 14"></polyline>
        </svg>
        <span>{duration} Stunden</span>
      </div>
      
      <div class="detail-item">
        <svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
          <circle cx="12" cy="10" r="3"></circle>
        </svg>
        <span>{location}</span>
      </div>
      
      <div class="detail-item">
        <svg class="icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
          <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path>
          <circle cx="9" cy="7" r="4"></circle>
          <path d="M23 21v-2a4 4 0 0 0-3-3.87"></path>
          <path d="M16 3.13a4 4 0 0 1 0 7.75"></path>
        </svg>
        <span>{availableSpots} von {maxParticipants} Plätzen frei</span>
      </div>
    </div>
    
    <div class="workshop-footer">
      <div class="workshop-price">
        <span class="price-amount">{price.toFixed(2)} €</span>
        <span class="price-label">pro Person</span>
      </div>
      
      {bookingUrl && status === 'booking' && (
        <Button href={bookingUrl} variant="primary">
          Jetzt buchen
        </Button>
      )}
      
      {status === 'full' && (
        <Button href="/kontakt" variant="outline">
          Warteliste
        </Button>
      )}
    </div>
  </div>
</article>

<style>
  .workshop-card {
    display: flex;
    flex-direction: column;
    background-color: var(--color-white);
    border: 1px solid var(--color-gray-200);
    border-radius: var(--radius-md);
    overflow: hidden;
    transition: transform var(--transition-base), box-shadow var(--transition-base);
  }

  .workshop-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-lg);
  }

  .workshop-image {
    position: relative;
    aspect-ratio: 16 / 9;
    overflow: hidden;
    background-color: var(--color-gray-100);
  }

  .workshop-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .workshop-badge {
    position: absolute;
    top: var(--space-2);
    right: var(--space-2);
  }

  .workshop-content {
    padding: clamp(1rem, 3vw, 1.5rem);
    display: flex;
    flex-direction: column;
    gap: clamp(0.75rem, 2vw, 1rem);
    flex: 1;
  }

  .workshop-title {
    font-size: clamp(1.125rem, 2.5vw, 1.25rem);
    font-weight: 600;
    margin: 0;
    line-height: 1.3;
  }

  .workshop-description {
    color: var(--color-gray-700);
    line-height: var(--line-height-relaxed);
    margin: 0;
    font-size: clamp(0.9375rem, 1.5vw, 1rem);
  }

  .workshop-details {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }

  .detail-item {
    display: flex;
    align-items: flex-start;
    gap: var(--space-2);
    font-size: clamp(0.875rem, 1.5vw, 0.9375rem);
    color: var(--color-gray-700);
    line-height: 1.5;
  }

  .detail-item span {
    flex: 1;
  }

  .icon {
    flex-shrink: 0;
    color: var(--color-olive);
    margin-top: 2px;
  }

  .workshop-footer {
    display: flex;
    justify-content: space-between;
    align-items: center;
    gap: var(--space-3);
    margin-top: auto;
    padding-top: var(--space-3);
    border-top: 1px solid var(--color-gray-200);
  }

  .workshop-price {
    display: flex;
    flex-direction: column;
  }

  .price-amount {
    font-size: clamp(1.25rem, 3vw, 1.5rem);
    font-weight: 700;
    color: var(--color-black);
    line-height: 1.2;
  }

  .price-label {
    font-size: clamp(0.75rem, 1.5vw, 0.875rem);
    color: var(--color-gray-700);
  }

  /* Mobile */
  @media (max-width: 639px) {
    .workshop-image {
      aspect-ratio: 4 / 3;
    }

    .workshop-footer {
      flex-direction: column;
      align-items: stretch;
      gap: var(--space-2);
    }

    .workshop-footer :global(.btn) {
      width: 100%;
      justify-content: center;
    }

    .detail-item {
      font-size: 0.875rem;
    }
  }

  /* Tablet */
  @media (min-width: 640px) and (max-width: 959px) {
    .workshop-footer {
      flex-wrap: wrap;
    }
  }

  /* Touch devices */
  @media (hover: none) {
    .workshop-card:hover {
      transform: none;
    }

    .workshop-card:active {
      transform: scale(0.98);
    }
  }
</style>

